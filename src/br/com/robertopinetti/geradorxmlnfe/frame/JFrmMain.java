/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package br.com.robertopinetti.geradorxmlnfe.frame;

import br.com.robertopinetti.geradorxmlnfe.Utils;
import br.com.robertopinetti.geradorxmlnfe.dao.ChaveNFeDAO;
import br.com.robertopinetti.geradorxmlnfe.dao.ICMSTotalNFeDAO;
import br.com.robertopinetti.geradorxmlnfe.frame.jtable.ProdutoTableModel;
import br.com.robertopinetti.geradorxmlnfe.xml.dao.KeyInfoType;
import br.com.robertopinetti.geradorxmlnfe.xml.dao.ObjectFactory;
import br.com.robertopinetti.geradorxmlnfe.xml.dao.ReferenceType;
import br.com.robertopinetti.geradorxmlnfe.xml.dao.SignatureType;
import br.com.robertopinetti.geradorxmlnfe.xml.dao.SignatureValueType;
import br.com.robertopinetti.geradorxmlnfe.xml.dao.SignedInfoType;
import br.com.robertopinetti.geradorxmlnfe.xml.dao.TNFe.InfNFe.Det;
import br.com.robertopinetti.geradorxmlnfe.xml.dao.TNfeProc;
import java.io.BufferedReader;
import java.io.File;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.io.PrintWriter;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JFileChooser;
import javax.swing.JOptionPane;
import javax.swing.JTable;
import javax.swing.SwingUtilities;
import javax.swing.UIManager;
import javax.swing.UnsupportedLookAndFeelException;
import javax.swing.filechooser.FileFilter;
import javax.xml.bind.JAXBContext;
import javax.xml.bind.JAXBElement;
import javax.xml.bind.JAXBException;
import javax.xml.bind.Marshaller;
import javax.xml.bind.Unmarshaller;
import javax.xml.namespace.QName;

/**
 *
 * @author asus
 */
public class JFrmMain extends javax.swing.JFrame {

    public TNfeProc nfeProc;
    private final ProdutoTableModel ptm;
    private ChaveNFeDAO chaveNFe;
    private HashMap<String, ICMSTotalNFeDAO> totais;

    /**
     * Creates new form JFrmMain
     */
    public JFrmMain() {

        this.ptm = new ProdutoTableModel();

        initComponents();

        try {

            UIManager.LookAndFeelInfo[] installedLookAndFeels = UIManager.getInstalledLookAndFeels();
            //UIManager.setLookAndFeel(installedLookAndFeels[0].getClassName());
            UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());
            SwingUtilities.updateComponentTreeUI(this);

        } catch (ClassNotFoundException | InstantiationException | IllegalAccessException | UnsupportedLookAndFeelException ex) {
            Logger.getLogger(JFrmMain.class.getName()).log(Level.SEVERE, null, ex);
        }

    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jToolBar1 = new javax.swing.JToolBar();
        btnOpen = new javax.swing.JButton();
        btnSave = new javax.swing.JButton();
        jSeparator1 = new javax.swing.JToolBar.Separator();
        btnAbout = new javax.swing.JButton();
        jSeparator2 = new javax.swing.JToolBar.Separator();
        jPanel1 = new javax.swing.JPanel();
        lblCHNfe = new javax.swing.JLabel();
        txtCHNfe = new javax.swing.JTextField();
        lblVersao = new javax.swing.JLabel();
        txtVersao = new javax.swing.JTextField();
        jTabbedPaneNFe = new javax.swing.JTabbedPane();
        jPanelTabIde = new javax.swing.JPanel();
        lblCUF = new javax.swing.JLabel();
        txtCUF = new javax.swing.JTextField();
        lblCNF = new javax.swing.JLabel();
        txtCNF = new javax.swing.JTextField();
        lblSerie = new javax.swing.JLabel();
        txtSerie = new javax.swing.JTextField();
        lblNatOp = new javax.swing.JLabel();
        txtNatOp = new javax.swing.JTextField();
        lblIndPag = new javax.swing.JLabel();
        cmbIndPag = new javax.swing.JComboBox<>();
        lblDhEmi = new javax.swing.JLabel();
        txtDtEmi = new javax.swing.JFormattedTextField();
        txtHrEmi = new javax.swing.JFormattedTextField();
        lblTpNF = new javax.swing.JLabel();
        cmbTpNF = new javax.swing.JComboBox<>();
        lblIdDest = new javax.swing.JLabel();
        cmbIdDest = new javax.swing.JComboBox<>();
        lblCMunFG = new javax.swing.JLabel();
        txtCMunFG = new javax.swing.JTextField();
        jPanelTabEmit = new javax.swing.JPanel();
        lblTCnpj = new javax.swing.JLabel();
        txtTCnpj = new javax.swing.JTextField();
        lblTCpf = new javax.swing.JLabel();
        txtTCpf = new javax.swing.JTextField();
        lblXNome = new javax.swing.JLabel();
        txtXNome = new javax.swing.JTextField();
        lblXFant = new javax.swing.JLabel();
        txtXFant = new javax.swing.JTextField();
        lblIE = new javax.swing.JLabel();
        txtIE = new javax.swing.JTextField();
        lblIM = new javax.swing.JLabel();
        txtIM = new javax.swing.JTextField();
        jPanelEnderEmit = new javax.swing.JPanel();
        lblCEP = new javax.swing.JLabel();
        txtCEP = new javax.swing.JTextField();
        lblXLgr = new javax.swing.JLabel();
        txtXLgr = new javax.swing.JTextField();
        lblNro = new javax.swing.JLabel();
        txtNro = new javax.swing.JTextField();
        lblXCpl = new javax.swing.JLabel();
        txtXCpl = new javax.swing.JTextField();
        lblXBairro = new javax.swing.JLabel();
        txtXBairro = new javax.swing.JTextField();
        lblCMun = new javax.swing.JLabel();
        txtCMun = new javax.swing.JTextField();
        lblXMun = new javax.swing.JLabel();
        txtXMun = new javax.swing.JTextField();
        lblUF = new javax.swing.JLabel();
        txtUF = new javax.swing.JTextField();
        lblCPais = new javax.swing.JLabel();
        txtCPais = new javax.swing.JTextField();
        lblXPais = new javax.swing.JLabel();
        txtXPais = new javax.swing.JTextField();
        lblFone = new javax.swing.JLabel();
        txtFone = new javax.swing.JTextField();
        jPanelTabDest = new javax.swing.JPanel();
        lblTCnpj1 = new javax.swing.JLabel();
        txtTCnpj1 = new javax.swing.JTextField();
        lblTCpf1 = new javax.swing.JLabel();
        txtTCpf1 = new javax.swing.JTextField();
        lblXNome1 = new javax.swing.JLabel();
        txtXNome1 = new javax.swing.JTextField();
        lblIE1 = new javax.swing.JLabel();
        txtIE1 = new javax.swing.JTextField();
        lblIM1 = new javax.swing.JLabel();
        txtIM1 = new javax.swing.JTextField();
        jPanelEnderEmit1 = new javax.swing.JPanel();
        lblCEP1 = new javax.swing.JLabel();
        txtCEP1 = new javax.swing.JTextField();
        lblXLgr1 = new javax.swing.JLabel();
        txtXLgr1 = new javax.swing.JTextField();
        lblNro1 = new javax.swing.JLabel();
        txtNro1 = new javax.swing.JTextField();
        lblXCpl1 = new javax.swing.JLabel();
        txtXCpl1 = new javax.swing.JTextField();
        lblXBairro1 = new javax.swing.JLabel();
        txtXBairro1 = new javax.swing.JTextField();
        lblCMun1 = new javax.swing.JLabel();
        txtCMun1 = new javax.swing.JTextField();
        lblXMun1 = new javax.swing.JLabel();
        txtXMun1 = new javax.swing.JTextField();
        lblUF1 = new javax.swing.JLabel();
        txtUF1 = new javax.swing.JTextField();
        lblCPais1 = new javax.swing.JLabel();
        txtCPais1 = new javax.swing.JTextField();
        lblXPais1 = new javax.swing.JLabel();
        txtXPais1 = new javax.swing.JTextField();
        lblFone1 = new javax.swing.JLabel();
        txtFone1 = new javax.swing.JTextField();
        jPanelTabDet = new javax.swing.JPanel();
        btnAdd = new javax.swing.JButton();
        btnDel = new javax.swing.JButton();
        btnImposto = new javax.swing.JButton();
        jScrollPane1 = new javax.swing.JScrollPane();
        jTableProd = new javax.swing.JTable();
        jPanelTabTotal = new javax.swing.JPanel();
        jPanel2 = new javax.swing.JPanel();
        lblTotICMSVBC = new javax.swing.JLabel();
        txtTotICMSVBC = new javax.swing.JTextField();
        lblTotICMSVICMS = new javax.swing.JLabel();
        txtTotICMSVICMS = new javax.swing.JTextField();
        lblTotICMSVPROD = new javax.swing.JLabel();
        txtTotICMSVPROD = new javax.swing.JTextField();
        lblTotICMSVIPI = new javax.swing.JLabel();
        txtTotICMSVIPI = new javax.swing.JTextField();
        lblTotICMSVPIS = new javax.swing.JLabel();
        txtTotICMSVPIS = new javax.swing.JTextField();
        lblTotICMSVCOFINS = new javax.swing.JLabel();
        txtTotICMSVCOFINS = new javax.swing.JTextField();
        lblTotICMSVNF = new javax.swing.JLabel();
        txtTotICMSVNF = new javax.swing.JTextField();
        lblTotICMSVTotTrib = new javax.swing.JLabel();
        txtTotICMSVTotTrib = new javax.swing.JTextField();
        jPanelTabInfAdic = new javax.swing.JPanel();
        lblInfAdFisco = new javax.swing.JLabel();
        jScrollPane3 = new javax.swing.JScrollPane();
        txtAreaInfAdFisco = new javax.swing.JTextArea();
        lblInfCpl = new javax.swing.JLabel();
        jScrollPane4 = new javax.swing.JScrollPane();
        txtAreaInfCpl = new javax.swing.JTextArea();
        jMenuBar1 = new javax.swing.JMenuBar();
        jMenuFile = new javax.swing.JMenu();
        jMenuItemOpen = new javax.swing.JMenuItem();
        jMenuItemSave = new javax.swing.JMenuItem();
        jMenuHelp = new javax.swing.JMenu();
        jMenuItemAbout = new javax.swing.JMenuItem();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("Gerador de XML para NF-e 3.10");
        setForeground(java.awt.Color.blue);

        jToolBar1.setRollover(true);

        btnOpen.setText("Abrir");
        btnOpen.setFocusable(false);
        btnOpen.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btnOpen.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        btnOpen.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnOpenActionPerformed(evt);
            }
        });
        jToolBar1.add(btnOpen);

        btnSave.setText("Salvar");
        btnSave.setFocusable(false);
        btnSave.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btnSave.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        btnSave.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnSaveActionPerformed(evt);
            }
        });
        jToolBar1.add(btnSave);
        jToolBar1.add(jSeparator1);

        btnAbout.setText("Sobre");
        btnAbout.setFocusable(false);
        btnAbout.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btnAbout.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jToolBar1.add(btnAbout);
        jToolBar1.add(jSeparator2);

        lblCHNfe.setText("Chave da NF-e");

        txtCHNfe.setEditable(false);

        lblVersao.setText("Versão");

        txtVersao.setEditable(false);

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(lblCHNfe)
                .addGap(18, 18, 18)
                .addComponent(txtCHNfe, javax.swing.GroupLayout.PREFERRED_SIZE, 330, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(lblVersao)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(txtVersao, javax.swing.GroupLayout.PREFERRED_SIZE, 50, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblCHNfe)
                    .addComponent(txtCHNfe, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblVersao)
                    .addComponent(txtVersao, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jTabbedPaneNFe.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                jTabbedPaneNFeStateChanged(evt);
            }
        });

        jPanelTabIde.setToolTipText("");
        jPanelTabIde.setName(""); // NOI18N

        lblCUF.setText("UF do emitente do Documento Fiscal");

        lblCNF.setText("Nº da Nota Fiscal");

        txtCNF.setEditable(false);

        lblSerie.setText("Serie");

        txtSerie.setEditable(false);

        lblNatOp.setText("Descrição da Natureza da Operação");

        lblIndPag.setText("Forma de Pagamento");

        cmbIndPag.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "0 - pagamento à vista", "1 - pagamento à prazo", "2 - outros" }));

        lblDhEmi.setText("Data e Hora de emissão");

        txtDtEmi.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.DateFormatter(new java.text.SimpleDateFormat("yyyy-MM-dd"))));

        txtHrEmi.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.DateFormatter(java.text.DateFormat.getTimeInstance())));

        lblTpNF.setText("Tipo do Documento Fiscal");

        cmbTpNF.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "0 - entrada", "1 - saída" }));

        lblIdDest.setText("Local de destino da operação");

        cmbIdDest.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "1 - Interna", "2 - Interestadual", "3 - Exterior" }));

        lblCMunFG.setText("Município de Ocorrência");

        javax.swing.GroupLayout jPanelTabIdeLayout = new javax.swing.GroupLayout(jPanelTabIde);
        jPanelTabIde.setLayout(jPanelTabIdeLayout);
        jPanelTabIdeLayout.setHorizontalGroup(
            jPanelTabIdeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanelTabIdeLayout.createSequentialGroup()
                .addGroup(jPanelTabIdeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanelTabIdeLayout.createSequentialGroup()
                        .addGap(10, 10, 10)
                        .addGroup(jPanelTabIdeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(jPanelTabIdeLayout.createSequentialGroup()
                                .addComponent(lblCUF)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(txtCUF, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(jPanelTabIdeLayout.createSequentialGroup()
                                .addComponent(lblCNF)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(txtCNF, javax.swing.GroupLayout.PREFERRED_SIZE, 70, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(lblSerie)
                                .addGap(12, 12, 12)
                                .addComponent(txtSerie, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(jPanelTabIdeLayout.createSequentialGroup()
                                .addComponent(lblNatOp)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(txtNatOp, javax.swing.GroupLayout.PREFERRED_SIZE, 310, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(jPanelTabIdeLayout.createSequentialGroup()
                                .addComponent(lblIndPag)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(cmbIndPag, javax.swing.GroupLayout.PREFERRED_SIZE, 180, javax.swing.GroupLayout.PREFERRED_SIZE))))
                    .addGroup(jPanelTabIdeLayout.createSequentialGroup()
                        .addContainerGap()
                        .addComponent(lblDhEmi)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(txtDtEmi, javax.swing.GroupLayout.PREFERRED_SIZE, 75, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(txtHrEmi, javax.swing.GroupLayout.PREFERRED_SIZE, 60, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanelTabIdeLayout.createSequentialGroup()
                        .addContainerGap()
                        .addGroup(jPanelTabIdeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                            .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jPanelTabIdeLayout.createSequentialGroup()
                                .addComponent(lblIdDest)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addComponent(cmbIdDest, javax.swing.GroupLayout.PREFERRED_SIZE, 180, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jPanelTabIdeLayout.createSequentialGroup()
                                .addComponent(lblTpNF)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(cmbTpNF, javax.swing.GroupLayout.PREFERRED_SIZE, 180, javax.swing.GroupLayout.PREFERRED_SIZE))))
                    .addGroup(jPanelTabIdeLayout.createSequentialGroup()
                        .addContainerGap()
                        .addComponent(lblCMunFG)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(txtCMunFG, javax.swing.GroupLayout.PREFERRED_SIZE, 70, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap(188, Short.MAX_VALUE))
        );
        jPanelTabIdeLayout.setVerticalGroup(
            jPanelTabIdeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanelTabIdeLayout.createSequentialGroup()
                .addGap(11, 11, 11)
                .addGroup(jPanelTabIdeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblCUF)
                    .addComponent(txtCUF, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(6, 6, 6)
                .addGroup(jPanelTabIdeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblCNF)
                    .addComponent(txtCNF, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(txtSerie, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblSerie))
                .addGap(6, 6, 6)
                .addGroup(jPanelTabIdeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblNatOp)
                    .addComponent(txtNatOp, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(4, 4, 4)
                .addGroup(jPanelTabIdeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblIndPag)
                    .addComponent(cmbIndPag, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanelTabIdeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblDhEmi)
                    .addComponent(txtDtEmi, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(txtHrEmi, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanelTabIdeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblTpNF)
                    .addComponent(cmbTpNF, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanelTabIdeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblIdDest)
                    .addComponent(cmbIdDest, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanelTabIdeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblCMunFG)
                    .addComponent(txtCMunFG, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap())
        );

        jTabbedPaneNFe.addTab("Identificação", jPanelTabIde);

        lblTCnpj.setText("C.N.P.J.");

        txtTCnpj.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txtTCnpjKeyReleased(evt);
            }
        });

        lblTCpf.setText("C.P.F.");

        lblXNome.setText("Razão Social ou Nome");

        lblXFant.setText("Nome fantasia");

        lblIE.setText("Inscrição Estadual");

        lblIM.setText("Inscrição Municipal");

        jPanelEnderEmit.setBorder(javax.swing.BorderFactory.createTitledBorder("Endereço do Emitente"));
        jPanelEnderEmit.setToolTipText("");

        lblCEP.setText("C.E.P.");

        lblXLgr.setText("Logradouro");

        lblNro.setText("Número");

        lblXCpl.setText("Complemento");

        lblXBairro.setText("Bairro");

        lblCMun.setText("Código do município");

        lblXMun.setText("Nome do município");

        lblUF.setText("U.F.");

        lblCPais.setText("Código do país");

        lblXPais.setText("Nome do país");

        lblFone.setText("Telefone");

        javax.swing.GroupLayout jPanelEnderEmitLayout = new javax.swing.GroupLayout(jPanelEnderEmit);
        jPanelEnderEmit.setLayout(jPanelEnderEmitLayout);
        jPanelEnderEmitLayout.setHorizontalGroup(
            jPanelEnderEmitLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanelEnderEmitLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanelEnderEmitLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanelEnderEmitLayout.createSequentialGroup()
                        .addComponent(lblFone)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(txtFone, javax.swing.GroupLayout.PREFERRED_SIZE, 95, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanelEnderEmitLayout.createSequentialGroup()
                        .addComponent(lblXBairro)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(txtXBairro, javax.swing.GroupLayout.PREFERRED_SIZE, 170, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(lblCMun)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(txtCMun, javax.swing.GroupLayout.PREFERRED_SIZE, 110, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanelEnderEmitLayout.createSequentialGroup()
                        .addGroup(jPanelEnderEmitLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jPanelEnderEmitLayout.createSequentialGroup()
                                .addComponent(lblCPais)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(txtCPais, javax.swing.GroupLayout.PREFERRED_SIZE, 70, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(lblXPais)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(txtXPais, javax.swing.GroupLayout.PREFERRED_SIZE, 70, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jPanelEnderEmitLayout.createSequentialGroup()
                                .addComponent(lblXMun)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(txtXMun, javax.swing.GroupLayout.PREFERRED_SIZE, 185, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(lblUF)))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(txtUF, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanelEnderEmitLayout.createSequentialGroup()
                        .addGroup(jPanelEnderEmitLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jPanelEnderEmitLayout.createSequentialGroup()
                                .addComponent(lblCEP)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(txtCEP, javax.swing.GroupLayout.PREFERRED_SIZE, 75, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(jPanelEnderEmitLayout.createSequentialGroup()
                                .addComponent(lblNro)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(txtNro, javax.swing.GroupLayout.PREFERRED_SIZE, 75, javax.swing.GroupLayout.PREFERRED_SIZE)))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(jPanelEnderEmitLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(jPanelEnderEmitLayout.createSequentialGroup()
                                .addComponent(lblXCpl)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(txtXCpl, javax.swing.GroupLayout.PREFERRED_SIZE, 205, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanelEnderEmitLayout.createSequentialGroup()
                                .addComponent(lblXLgr)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(txtXLgr, javax.swing.GroupLayout.PREFERRED_SIZE, 300, javax.swing.GroupLayout.PREFERRED_SIZE)))))
                .addContainerGap(158, Short.MAX_VALUE))
        );
        jPanelEnderEmitLayout.setVerticalGroup(
            jPanelEnderEmitLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanelEnderEmitLayout.createSequentialGroup()
                .addGap(11, 11, 11)
                .addGroup(jPanelEnderEmitLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblCEP)
                    .addComponent(txtCEP, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblXLgr)
                    .addComponent(txtXLgr, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanelEnderEmitLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblNro)
                    .addComponent(txtNro, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblXCpl)
                    .addComponent(txtXCpl, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(8, 8, 8)
                .addGroup(jPanelEnderEmitLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblXBairro)
                    .addComponent(txtXBairro, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblCMun)
                    .addComponent(txtCMun, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanelEnderEmitLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblXMun)
                    .addComponent(txtXMun, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblUF)
                    .addComponent(txtUF, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanelEnderEmitLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblCPais)
                    .addComponent(txtCPais, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblXPais)
                    .addComponent(txtXPais, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanelEnderEmitLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblFone)
                    .addComponent(txtFone, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(39, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout jPanelTabEmitLayout = new javax.swing.GroupLayout(jPanelTabEmit);
        jPanelTabEmit.setLayout(jPanelTabEmitLayout);
        jPanelTabEmitLayout.setHorizontalGroup(
            jPanelTabEmitLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanelTabEmitLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanelTabEmitLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jPanelEnderEmit, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addGroup(jPanelTabEmitLayout.createSequentialGroup()
                        .addGroup(jPanelTabEmitLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(jPanelTabEmitLayout.createSequentialGroup()
                                .addComponent(lblTCnpj)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(txtTCnpj, javax.swing.GroupLayout.PREFERRED_SIZE, 180, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(jPanelTabEmitLayout.createSequentialGroup()
                                .addComponent(lblTCpf)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(txtTCpf, javax.swing.GroupLayout.PREFERRED_SIZE, 180, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(jPanelTabEmitLayout.createSequentialGroup()
                                .addComponent(lblXNome)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(txtXNome, javax.swing.GroupLayout.PREFERRED_SIZE, 290, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(jPanelTabEmitLayout.createSequentialGroup()
                                .addComponent(lblXFant)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(txtXFant, javax.swing.GroupLayout.PREFERRED_SIZE, 290, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(jPanelTabEmitLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                                .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jPanelTabEmitLayout.createSequentialGroup()
                                    .addComponent(lblIM)
                                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                    .addComponent(txtIM, javax.swing.GroupLayout.DEFAULT_SIZE, 118, Short.MAX_VALUE))
                                .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jPanelTabEmitLayout.createSequentialGroup()
                                    .addComponent(lblIE)
                                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                    .addComponent(txtIE))))
                        .addGap(0, 0, Short.MAX_VALUE)))
                .addContainerGap())
        );
        jPanelTabEmitLayout.setVerticalGroup(
            jPanelTabEmitLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanelTabEmitLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanelTabEmitLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblTCnpj)
                    .addComponent(txtTCnpj, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanelTabEmitLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblTCpf)
                    .addComponent(txtTCpf, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanelTabEmitLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblXNome)
                    .addComponent(txtXNome, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanelTabEmitLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblXFant)
                    .addComponent(txtXFant, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanelTabEmitLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblIE)
                    .addComponent(txtIE, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanelTabEmitLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblIM)
                    .addComponent(txtIM, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addComponent(jPanelEnderEmit, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jTabbedPaneNFe.addTab("Emitente", jPanelTabEmit);

        lblTCnpj1.setText("C.N.P.J.");

        lblTCpf1.setText("C.P.F.");

        lblXNome1.setText("Razão Social ou Nome");

        lblIE1.setText("Inscrição Estadual");

        lblIM1.setText("Inscrição Municipal");

        jPanelEnderEmit1.setBorder(javax.swing.BorderFactory.createTitledBorder("Endereço do Destinatario"));
        jPanelEnderEmit1.setToolTipText("");

        lblCEP1.setText("C.E.P.");

        lblXLgr1.setText("Logradouro");

        lblNro1.setText("Número");

        lblXCpl1.setText("Complemento");

        lblXBairro1.setText("Bairro");

        lblCMun1.setText("Código do município");

        lblXMun1.setText("Nome do município");

        lblUF1.setText("U.F.");

        lblCPais1.setText("Código do país");

        lblXPais1.setText("Nome do país");

        lblFone1.setText("Telefone");

        javax.swing.GroupLayout jPanelEnderEmit1Layout = new javax.swing.GroupLayout(jPanelEnderEmit1);
        jPanelEnderEmit1.setLayout(jPanelEnderEmit1Layout);
        jPanelEnderEmit1Layout.setHorizontalGroup(
            jPanelEnderEmit1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanelEnderEmit1Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanelEnderEmit1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanelEnderEmit1Layout.createSequentialGroup()
                        .addComponent(lblFone1)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(txtFone1, javax.swing.GroupLayout.PREFERRED_SIZE, 95, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanelEnderEmit1Layout.createSequentialGroup()
                        .addComponent(lblXBairro1)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(txtXBairro1, javax.swing.GroupLayout.PREFERRED_SIZE, 170, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(lblCMun1)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(txtCMun1, javax.swing.GroupLayout.PREFERRED_SIZE, 110, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanelEnderEmit1Layout.createSequentialGroup()
                        .addGroup(jPanelEnderEmit1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jPanelEnderEmit1Layout.createSequentialGroup()
                                .addComponent(lblCPais1)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(txtCPais1, javax.swing.GroupLayout.PREFERRED_SIZE, 70, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(lblXPais1)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(txtXPais1, javax.swing.GroupLayout.PREFERRED_SIZE, 70, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jPanelEnderEmit1Layout.createSequentialGroup()
                                .addComponent(lblXMun1)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(txtXMun1, javax.swing.GroupLayout.PREFERRED_SIZE, 185, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(lblUF1)))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(txtUF1, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanelEnderEmit1Layout.createSequentialGroup()
                        .addGroup(jPanelEnderEmit1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(jPanelEnderEmit1Layout.createSequentialGroup()
                                .addComponent(lblCEP1)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(txtCEP1, javax.swing.GroupLayout.PREFERRED_SIZE, 75, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(jPanelEnderEmit1Layout.createSequentialGroup()
                                .addComponent(lblNro1)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(txtNro1, javax.swing.GroupLayout.PREFERRED_SIZE, 75, javax.swing.GroupLayout.PREFERRED_SIZE)))
                        .addGap(10, 10, 10)
                        .addGroup(jPanelEnderEmit1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(lblXCpl1)
                            .addComponent(lblXLgr1))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(jPanelEnderEmit1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(txtXCpl1, javax.swing.GroupLayout.PREFERRED_SIZE, 205, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(txtXLgr1, javax.swing.GroupLayout.PREFERRED_SIZE, 300, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addContainerGap(148, Short.MAX_VALUE))
        );
        jPanelEnderEmit1Layout.setVerticalGroup(
            jPanelEnderEmit1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanelEnderEmit1Layout.createSequentialGroup()
                .addGap(11, 11, 11)
                .addGroup(jPanelEnderEmit1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblCEP1)
                    .addComponent(txtCEP1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblXLgr1)
                    .addComponent(txtXLgr1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanelEnderEmit1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblNro1)
                    .addComponent(txtNro1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblXCpl1)
                    .addComponent(txtXCpl1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(8, 8, 8)
                .addGroup(jPanelEnderEmit1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblXBairro1)
                    .addComponent(txtXBairro1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblCMun1)
                    .addComponent(txtCMun1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanelEnderEmit1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblXMun1)
                    .addComponent(txtXMun1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblUF1)
                    .addComponent(txtUF1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanelEnderEmit1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblCPais1)
                    .addComponent(txtCPais1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblXPais1)
                    .addComponent(txtXPais1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanelEnderEmit1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblFone1)
                    .addComponent(txtFone1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(39, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout jPanelTabDestLayout = new javax.swing.GroupLayout(jPanelTabDest);
        jPanelTabDest.setLayout(jPanelTabDestLayout);
        jPanelTabDestLayout.setHorizontalGroup(
            jPanelTabDestLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanelTabDestLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanelTabDestLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanelTabDestLayout.createSequentialGroup()
                        .addGroup(jPanelTabDestLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(jPanelTabDestLayout.createSequentialGroup()
                                .addComponent(lblTCnpj1)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(txtTCnpj1, javax.swing.GroupLayout.PREFERRED_SIZE, 180, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(jPanelTabDestLayout.createSequentialGroup()
                                .addComponent(lblTCpf1)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(txtTCpf1, javax.swing.GroupLayout.PREFERRED_SIZE, 180, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(jPanelTabDestLayout.createSequentialGroup()
                                .addComponent(lblXNome1)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(txtXNome1, javax.swing.GroupLayout.PREFERRED_SIZE, 290, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(jPanelTabDestLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                                .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jPanelTabDestLayout.createSequentialGroup()
                                    .addComponent(lblIM1)
                                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                    .addComponent(txtIM1))
                                .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jPanelTabDestLayout.createSequentialGroup()
                                    .addComponent(lblIE1)
                                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                    .addComponent(txtIE1, javax.swing.GroupLayout.PREFERRED_SIZE, 120, javax.swing.GroupLayout.PREFERRED_SIZE))))
                        .addGap(0, 260, Short.MAX_VALUE))
                    .addComponent(jPanelEnderEmit1, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
        );
        jPanelTabDestLayout.setVerticalGroup(
            jPanelTabDestLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanelTabDestLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanelTabDestLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblTCnpj1)
                    .addComponent(txtTCnpj1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanelTabDestLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblTCpf1)
                    .addComponent(txtTCpf1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanelTabDestLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblXNome1)
                    .addComponent(txtXNome1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanelTabDestLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblIE1)
                    .addComponent(txtIE1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanelTabDestLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblIM1)
                    .addComponent(txtIM1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addComponent(jPanelEnderEmit1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(28, Short.MAX_VALUE))
        );

        jTabbedPaneNFe.addTab("Destinatário", jPanelTabDest);

        btnAdd.setText("Incluir");
        btnAdd.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnAddActionPerformed(evt);
            }
        });

        btnDel.setText("Excluir");
        btnDel.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnDelActionPerformed(evt);
            }
        });

        btnImposto.setText("Impostos");
        btnImposto.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnImpostoActionPerformed(evt);
            }
        });

        jTableProd.setColumnSelectionAllowed(true);
        jTableProd.setSelectionMode(javax.swing.ListSelectionModel.SINGLE_SELECTION);
        jScrollPane1.setViewportView(jTableProd);
        jTableProd.getColumnModel().getSelectionModel().setSelectionMode(javax.swing.ListSelectionModel.SINGLE_SELECTION);

        javax.swing.GroupLayout jPanelTabDetLayout = new javax.swing.GroupLayout(jPanelTabDet);
        jPanelTabDet.setLayout(jPanelTabDetLayout);
        jPanelTabDetLayout.setHorizontalGroup(
            jPanelTabDetLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanelTabDetLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanelTabDetLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 665, Short.MAX_VALUE)
                    .addGroup(jPanelTabDetLayout.createSequentialGroup()
                        .addComponent(btnAdd)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btnDel)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btnImposto)
                        .addGap(0, 0, Short.MAX_VALUE)))
                .addContainerGap())
        );
        jPanelTabDetLayout.setVerticalGroup(
            jPanelTabDetLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanelTabDetLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanelTabDetLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btnDel)
                    .addComponent(btnAdd)
                    .addComponent(btnImposto))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 355, Short.MAX_VALUE)
                .addContainerGap())
        );

        jTabbedPaneNFe.addTab("Detalhes", jPanelTabDet);

        jPanel2.setBorder(javax.swing.BorderFactory.createTitledBorder("Totais referentes ao ICMS"));
        jPanel2.setPreferredSize(new java.awt.Dimension(665, 220));

        lblTotICMSVBC.setText("BC do ICMS");

        txtTotICMSVBC.setEditable(false);

        lblTotICMSVICMS.setText("Valor Total do ICMS");

        txtTotICMSVICMS.setEditable(false);

        lblTotICMSVPROD.setText("Valor Total dos produtos");

        txtTotICMSVPROD.setEditable(false);

        lblTotICMSVIPI.setText("Valor Total do IPI");

        txtTotICMSVIPI.setEditable(false);

        lblTotICMSVPIS.setText("Valor do PIS");

        txtTotICMSVPIS.setEditable(false);

        lblTotICMSVCOFINS.setText("Valor do COFINS");

        txtTotICMSVCOFINS.setEditable(false);

        lblTotICMSVNF.setText("Valor Total da NF-e");

        txtTotICMSVNF.setEditable(false);

        lblTotICMSVTotTrib.setText("Valor estimado total de impostos");

        txtTotICMSVTotTrib.setEditable(false);

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addComponent(lblTotICMSVBC)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(txtTotICMSVBC, javax.swing.GroupLayout.PREFERRED_SIZE, 120, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addComponent(lblTotICMSVICMS)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(txtTotICMSVICMS, javax.swing.GroupLayout.PREFERRED_SIZE, 120, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addComponent(lblTotICMSVPROD)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(txtTotICMSVPROD, javax.swing.GroupLayout.PREFERRED_SIZE, 120, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addComponent(lblTotICMSVIPI)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(txtTotICMSVIPI, javax.swing.GroupLayout.PREFERRED_SIZE, 120, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addComponent(lblTotICMSVPIS)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(txtTotICMSVPIS, javax.swing.GroupLayout.PREFERRED_SIZE, 120, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addComponent(lblTotICMSVCOFINS)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(txtTotICMSVCOFINS, javax.swing.GroupLayout.PREFERRED_SIZE, 120, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addComponent(lblTotICMSVNF)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(txtTotICMSVNF, javax.swing.GroupLayout.PREFERRED_SIZE, 120, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addComponent(lblTotICMSVTotTrib)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(txtTotICMSVTotTrib, javax.swing.GroupLayout.PREFERRED_SIZE, 120, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap(358, Short.MAX_VALUE))
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblTotICMSVBC)
                    .addComponent(txtTotICMSVBC, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblTotICMSVICMS)
                    .addComponent(txtTotICMSVICMS, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblTotICMSVPROD)
                    .addComponent(txtTotICMSVPROD, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblTotICMSVIPI)
                    .addComponent(txtTotICMSVIPI, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblTotICMSVPIS)
                    .addComponent(txtTotICMSVPIS, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblTotICMSVCOFINS)
                    .addComponent(txtTotICMSVCOFINS, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblTotICMSVNF)
                    .addComponent(txtTotICMSVNF, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblTotICMSVTotTrib)
                    .addComponent(txtTotICMSVTotTrib, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(27, Short.MAX_VALUE))
        );

        txtTotICMSVBC.getAccessibleContext().setAccessibleParent(lblTotICMSVBC);
        txtTotICMSVICMS.getAccessibleContext().setAccessibleParent(lblTotICMSVICMS);
        txtTotICMSVPROD.getAccessibleContext().setAccessibleParent(lblTotICMSVPROD);
        txtTotICMSVIPI.getAccessibleContext().setAccessibleParent(lblTotICMSVIPI);
        txtTotICMSVPIS.getAccessibleContext().setAccessibleParent(lblTotICMSVPIS);
        lblTotICMSVCOFINS.getAccessibleContext().setAccessibleParent(lblTotICMSVCOFINS);
        txtTotICMSVCOFINS.getAccessibleContext().setAccessibleParent(lblTotICMSVCOFINS);
        txtTotICMSVNF.getAccessibleContext().setAccessibleParent(lblTotICMSVNF);
        lblTotICMSVTotTrib.getAccessibleContext().setAccessibleParent(lblTotICMSVTotTrib);
        txtTotICMSVTotTrib.getAccessibleContext().setAccessibleParent(lblTotICMSVTotTrib);

        javax.swing.GroupLayout jPanelTabTotalLayout = new javax.swing.GroupLayout(jPanelTabTotal);
        jPanelTabTotal.setLayout(jPanelTabTotalLayout);
        jPanelTabTotalLayout.setHorizontalGroup(
            jPanelTabTotalLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanelTabTotalLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addContainerGap())
        );
        jPanelTabTotalLayout.setVerticalGroup(
            jPanelTabTotalLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanelTabTotalLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, 263, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(132, Short.MAX_VALUE))
        );

        jTabbedPaneNFe.addTab("Totais da NF-e", jPanelTabTotal);

        lblInfAdFisco.setText("Informações adicionais de interesse do Fisco");

        txtAreaInfAdFisco.setColumns(20);
        txtAreaInfAdFisco.setRows(5);
        jScrollPane3.setViewportView(txtAreaInfAdFisco);

        lblInfCpl.setText("Informações complementares de interesse do Contribuinte");

        txtAreaInfCpl.setColumns(20);
        txtAreaInfCpl.setRows(5);
        jScrollPane4.setViewportView(txtAreaInfCpl);

        javax.swing.GroupLayout jPanelTabInfAdicLayout = new javax.swing.GroupLayout(jPanelTabInfAdic);
        jPanelTabInfAdic.setLayout(jPanelTabInfAdicLayout);
        jPanelTabInfAdicLayout.setHorizontalGroup(
            jPanelTabInfAdicLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanelTabInfAdicLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanelTabInfAdicLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane3)
                    .addComponent(jScrollPane4)
                    .addGroup(jPanelTabInfAdicLayout.createSequentialGroup()
                        .addGroup(jPanelTabInfAdicLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(lblInfAdFisco)
                            .addComponent(lblInfCpl))
                        .addGap(0, 385, Short.MAX_VALUE)))
                .addContainerGap())
        );
        jPanelTabInfAdicLayout.setVerticalGroup(
            jPanelTabInfAdicLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanelTabInfAdicLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(lblInfAdFisco)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane3, javax.swing.GroupLayout.PREFERRED_SIZE, 140, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(lblInfCpl)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane4, javax.swing.GroupLayout.PREFERRED_SIZE, 140, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(57, Short.MAX_VALUE))
        );

        jTabbedPaneNFe.addTab("Informações adicionais", jPanelTabInfAdic);

        jMenuFile.setText("Arquivo");

        jMenuItemOpen.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_O, java.awt.event.InputEvent.CTRL_MASK));
        jMenuItemOpen.setText("Abrir");
        jMenuItemOpen.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItemOpenActionPerformed(evt);
            }
        });
        jMenuFile.add(jMenuItemOpen);

        jMenuItemSave.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_S, java.awt.event.InputEvent.CTRL_MASK));
        jMenuItemSave.setText("Salvar");
        jMenuItemSave.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItemSaveActionPerformed(evt);
            }
        });
        jMenuFile.add(jMenuItemSave);

        jMenuBar1.add(jMenuFile);

        jMenuHelp.setText("Ajuda");

        jMenuItemAbout.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_F1, java.awt.event.InputEvent.CTRL_MASK));
        jMenuItemAbout.setText("Sobre");
        jMenuItemAbout.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItemAboutActionPerformed(evt);
            }
        });
        jMenuHelp.add(jMenuItemAbout);

        jMenuBar1.add(jMenuHelp);

        setJMenuBar(jMenuBar1);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jToolBar1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jTabbedPaneNFe))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(jToolBar1, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jTabbedPaneNFe, javax.swing.GroupLayout.PREFERRED_SIZE, 434, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void jMenuItemOpenActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItemOpenActionPerformed
        this.abrir();
    }//GEN-LAST:event_jMenuItemOpenActionPerformed

    private void jMenuItemSaveActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItemSaveActionPerformed
        this.gravar();
    }//GEN-LAST:event_jMenuItemSaveActionPerformed

    private void jMenuItemAboutActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItemAboutActionPerformed
        JOptionPane.showMessageDialog(null, "Criado por: Roberto Martinelli Pinetti", "Sobre...", JOptionPane.INFORMATION_MESSAGE);
    }//GEN-LAST:event_jMenuItemAboutActionPerformed

    private void btnOpenActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnOpenActionPerformed
        this.abrir();
    }//GEN-LAST:event_btnOpenActionPerformed

    private void btnSaveActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnSaveActionPerformed
        this.gravar();
    }//GEN-LAST:event_btnSaveActionPerformed

    /**
     * Evento do botão btnAdd para incluir item selecionado da jTableProd
     *
     * @param evt
     */
    private void btnAddActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnAddActionPerformed

        int ultimo = this.nfeProc.getNFe().getInfNFe().getDet().size();

        // Adiciona uma linha
        this.nfeProc.getNFe().getInfNFe().getDet().add(this.ptm.addRow());

        // Preenche o número do item
        Det d = new Det();
        d.setNItem(String.valueOf(ultimo));

        this.nfeProc.getNFe().getInfNFe().getDet().set(ultimo, d);

        // Atualiza a tabela do JTable
//        this.atualizaTabProd();

    }//GEN-LAST:event_btnAddActionPerformed

    /**
     * Evento do botão btnDel para eliminar o item selecionado da jTableProd
     *
     * @param evt
     */
    private void btnDelActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnDelActionPerformed

        int linha = this.jTableProd.getSelectedRow();

        if (linha < 0) {
            JOptionPane.showMessageDialog(null, "Selecionar a linha que será eliminada!", "Erro...", JOptionPane.ERROR_MESSAGE);
        } else if (this.nfeProc.getNFe().getInfNFe().getDet().size() > 1) {

            Det d = this.nfeProc.getNFe().getInfNFe().getDet().get(linha);
            this.totais.remove(d.getNItem());

            this.ptm.removeRow(linha);
            this.nfeProc.getNFe().getInfNFe().getDet().remove(linha);

        } else if (this.nfeProc.getNFe().getInfNFe().getDet().size() == 1) {
            JOptionPane.showMessageDialog(null, "O item é obrigatório!", "Erro...", JOptionPane.ERROR_MESSAGE);
        }   // if (linha < 0)

    }//GEN-LAST:event_btnDelActionPerformed

    private void btnImpostoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnImpostoActionPerformed

        int nItem = this.jTableProd.getSelectedRow();

        if (nItem < 0) {

            JOptionPane.showMessageDialog(null, "Selecionar um item da NF-e", "Erro", JOptionPane.ERROR_MESSAGE);

        } else {

            // Preenche os valores dos impostos no POP-UP
            Det d = this.nfeProc.getNFe().getInfNFe().getDet().get(nItem);
            d.setNItem(String.valueOf(nItem + 1));
            d.setProd(d.getProd());
            d.setImposto(d.getImposto());
            d.setImpostoDevol(d.getImpostoDevol());
            d.setInfAdProd(d.getInfAdProd());

            // Chama o POP-UP
            JDialogImposto dialogImposto = new JDialogImposto(this, true, d, this.totais);
            dialogImposto.setVisible(true);

            // Atualiza os valores dos impostos
            this.nfeProc.getNFe().getInfNFe().getDet().set(nItem, d);
            this.calcTotalNFe();
            this.atualizaTabProd();

        }   // if (nItem < 0)

    }//GEN-LAST:event_btnImpostoActionPerformed

    private void txtTCnpjKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtTCnpjKeyReleased

    }//GEN-LAST:event_txtTCnpjKeyReleased

    private void jTabbedPaneNFeStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_jTabbedPaneNFeStateChanged

        switch (jTabbedPaneNFe.getSelectedIndex()) {

            case 4: // Totais da NF-e
                this.calcTotalNFe();

        }   // switch (jTabbedPaneNFe.getSelectedIndex())

    }//GEN-LAST:event_jTabbedPaneNFeStateChanged

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnAbout;
    private javax.swing.JButton btnAdd;
    private javax.swing.JButton btnDel;
    private javax.swing.JButton btnImposto;
    private javax.swing.JButton btnOpen;
    private javax.swing.JButton btnSave;
    private javax.swing.JComboBox<String> cmbIdDest;
    private javax.swing.JComboBox<String> cmbIndPag;
    private javax.swing.JComboBox<String> cmbTpNF;
    private javax.swing.JMenuBar jMenuBar1;
    private javax.swing.JMenu jMenuFile;
    private javax.swing.JMenu jMenuHelp;
    private javax.swing.JMenuItem jMenuItemAbout;
    private javax.swing.JMenuItem jMenuItemOpen;
    private javax.swing.JMenuItem jMenuItemSave;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanelEnderEmit;
    private javax.swing.JPanel jPanelEnderEmit1;
    private javax.swing.JPanel jPanelTabDest;
    private javax.swing.JPanel jPanelTabDet;
    private javax.swing.JPanel jPanelTabEmit;
    private javax.swing.JPanel jPanelTabIde;
    private javax.swing.JPanel jPanelTabInfAdic;
    private javax.swing.JPanel jPanelTabTotal;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JScrollPane jScrollPane4;
    private javax.swing.JToolBar.Separator jSeparator1;
    private javax.swing.JToolBar.Separator jSeparator2;
    private javax.swing.JTabbedPane jTabbedPaneNFe;
    private javax.swing.JTable jTableProd;
    private javax.swing.JToolBar jToolBar1;
    private javax.swing.JLabel lblCEP;
    private javax.swing.JLabel lblCEP1;
    private javax.swing.JLabel lblCHNfe;
    private javax.swing.JLabel lblCMun;
    private javax.swing.JLabel lblCMun1;
    private javax.swing.JLabel lblCMunFG;
    private javax.swing.JLabel lblCNF;
    private javax.swing.JLabel lblCPais;
    private javax.swing.JLabel lblCPais1;
    private javax.swing.JLabel lblCUF;
    private javax.swing.JLabel lblDhEmi;
    private javax.swing.JLabel lblFone;
    private javax.swing.JLabel lblFone1;
    private javax.swing.JLabel lblIE;
    private javax.swing.JLabel lblIE1;
    private javax.swing.JLabel lblIM;
    private javax.swing.JLabel lblIM1;
    private javax.swing.JLabel lblIdDest;
    private javax.swing.JLabel lblIndPag;
    private javax.swing.JLabel lblInfAdFisco;
    private javax.swing.JLabel lblInfCpl;
    private javax.swing.JLabel lblNatOp;
    private javax.swing.JLabel lblNro;
    private javax.swing.JLabel lblNro1;
    private javax.swing.JLabel lblSerie;
    private javax.swing.JLabel lblTCnpj;
    private javax.swing.JLabel lblTCnpj1;
    private javax.swing.JLabel lblTCpf;
    private javax.swing.JLabel lblTCpf1;
    private javax.swing.JLabel lblTotICMSVBC;
    private javax.swing.JLabel lblTotICMSVCOFINS;
    private javax.swing.JLabel lblTotICMSVICMS;
    private javax.swing.JLabel lblTotICMSVIPI;
    private javax.swing.JLabel lblTotICMSVNF;
    private javax.swing.JLabel lblTotICMSVPIS;
    private javax.swing.JLabel lblTotICMSVPROD;
    private javax.swing.JLabel lblTotICMSVTotTrib;
    private javax.swing.JLabel lblTpNF;
    private javax.swing.JLabel lblUF;
    private javax.swing.JLabel lblUF1;
    private javax.swing.JLabel lblVersao;
    private javax.swing.JLabel lblXBairro;
    private javax.swing.JLabel lblXBairro1;
    private javax.swing.JLabel lblXCpl;
    private javax.swing.JLabel lblXCpl1;
    private javax.swing.JLabel lblXFant;
    private javax.swing.JLabel lblXLgr;
    private javax.swing.JLabel lblXLgr1;
    private javax.swing.JLabel lblXMun;
    private javax.swing.JLabel lblXMun1;
    private javax.swing.JLabel lblXNome;
    private javax.swing.JLabel lblXNome1;
    private javax.swing.JLabel lblXPais;
    private javax.swing.JLabel lblXPais1;
    private javax.swing.JTextArea txtAreaInfAdFisco;
    private javax.swing.JTextArea txtAreaInfCpl;
    private javax.swing.JTextField txtCEP;
    private javax.swing.JTextField txtCEP1;
    private javax.swing.JTextField txtCHNfe;
    private javax.swing.JTextField txtCMun;
    private javax.swing.JTextField txtCMun1;
    private javax.swing.JTextField txtCMunFG;
    private javax.swing.JTextField txtCNF;
    private javax.swing.JTextField txtCPais;
    private javax.swing.JTextField txtCPais1;
    private javax.swing.JTextField txtCUF;
    private javax.swing.JFormattedTextField txtDtEmi;
    private javax.swing.JTextField txtFone;
    private javax.swing.JTextField txtFone1;
    private javax.swing.JFormattedTextField txtHrEmi;
    private javax.swing.JTextField txtIE;
    private javax.swing.JTextField txtIE1;
    private javax.swing.JTextField txtIM;
    private javax.swing.JTextField txtIM1;
    private javax.swing.JTextField txtNatOp;
    private javax.swing.JTextField txtNro;
    private javax.swing.JTextField txtNro1;
    private javax.swing.JTextField txtSerie;
    private javax.swing.JTextField txtTCnpj;
    private javax.swing.JTextField txtTCnpj1;
    private javax.swing.JTextField txtTCpf;
    private javax.swing.JTextField txtTCpf1;
    private javax.swing.JTextField txtTotICMSVBC;
    private javax.swing.JTextField txtTotICMSVCOFINS;
    private javax.swing.JTextField txtTotICMSVICMS;
    private javax.swing.JTextField txtTotICMSVIPI;
    private javax.swing.JTextField txtTotICMSVNF;
    private javax.swing.JTextField txtTotICMSVPIS;
    private javax.swing.JTextField txtTotICMSVPROD;
    private javax.swing.JTextField txtTotICMSVTotTrib;
    private javax.swing.JTextField txtUF;
    private javax.swing.JTextField txtUF1;
    private javax.swing.JTextField txtVersao;
    private javax.swing.JTextField txtXBairro;
    private javax.swing.JTextField txtXBairro1;
    private javax.swing.JTextField txtXCpl;
    private javax.swing.JTextField txtXCpl1;
    private javax.swing.JTextField txtXFant;
    private javax.swing.JTextField txtXLgr;
    private javax.swing.JTextField txtXLgr1;
    private javax.swing.JTextField txtXMun;
    private javax.swing.JTextField txtXMun1;
    private javax.swing.JTextField txtXNome;
    private javax.swing.JTextField txtXNome1;
    private javax.swing.JTextField txtXPais;
    private javax.swing.JTextField txtXPais1;
    // End of variables declaration//GEN-END:variables

    /**
     * Carrega o arquivo XML da NF-e
     */
    private void abrir() {

        JFileChooser fileChooser = new JFileChooser();

        fileChooser.setFileFilter(new FileFilter() {
            @Override
            public boolean accept(File f) {
                return (f.getName().endsWith(".xml")) || f.isDirectory();
            }

            @Override
            public String getDescription() {
                return "*.xml";
            }
        });

        int returnVal = fileChooser.showOpenDialog(this);

        if (returnVal == JFileChooser.APPROVE_OPTION) {

            try {

                File file = fileChooser.getSelectedFile();

                JAXBContext context = JAXBContext.newInstance("br.com.robertopinetti.geradorxmlnfe.xml.dao");
                Unmarshaller unmarshaller = context.createUnmarshaller();
                JAXBElement<TNfeProc> element = (JAXBElement<TNfeProc>) unmarshaller.unmarshal(file);

                this.nfeProc = element.getValue();

                this.preencheTela();

            } catch (JAXBException ex) {
                JOptionPane.showMessageDialog(null, ex.getMessage(), "Erro no XML!", JOptionPane.ERROR_MESSAGE);
                Logger.getLogger(JFrmMain.class.getName()).log(Level.SEVERE, null, ex);
            }

        } else {
            System.out.println("File access cancelled by user.");
        }

    }   // abrir()

    /**
     * Preenche os campos da Tela com base no XML da NF-e
     */
    private void preencheTela() {

        // Controle do total dos impostos de ICMS
        if (totais == null) {
            totais = new HashMap<>();
        }   // if (totais == null)

        // Chave da NF-e
        this.txtCHNfe.setText(this.nfeProc.getNFe().getInfNFe().getId().substring(3));
        // Versão do XML
        this.txtVersao.setText(this.nfeProc.getNFe().getInfNFe().getVersao());

        // Identificação da NF-e
        this.txtCUF.setText(this.nfeProc.getNFe().getInfNFe().getIde().getCUF());
        this.txtCNF.setText(this.nfeProc.getNFe().getInfNFe().getIde().getCNF());
        this.txtSerie.setText(this.nfeProc.getNFe().getInfNFe().getIde().getSerie());
        this.txtNatOp.setText(this.nfeProc.getNFe().getInfNFe().getIde().getNatOp());
        this.cmbIndPag.setSelectedIndex(Integer.parseInt(this.nfeProc.getNFe().getInfNFe().getIde().getIndPag()));
        this.txtDtEmi.setText(this.nfeProc.getNFe().getInfNFe().getIde().getDhEmi().substring(0, 10));
        this.txtHrEmi.setText(this.nfeProc.getNFe().getInfNFe().getIde().getDhEmi().substring(11, 19));
        this.cmbTpNF.setSelectedIndex(Integer.parseInt(this.nfeProc.getNFe().getInfNFe().getIde().getTpNF()));
        this.cmbIdDest.setSelectedIndex(Integer.parseInt(this.nfeProc.getNFe().getInfNFe().getIde().getIdDest()) - 1);
        this.txtCMunFG.setText(this.nfeProc.getNFe().getInfNFe().getIde().getCMunFG());

        // Emitente
        this.txtTCnpj.setText(this.nfeProc.getNFe().getInfNFe().getEmit().getCNPJ());
        this.txtTCpf.setText(this.nfeProc.getNFe().getInfNFe().getEmit().getCPF());
        this.txtXNome.setText(this.nfeProc.getNFe().getInfNFe().getEmit().getXNome());
        this.txtXFant.setText(this.nfeProc.getNFe().getInfNFe().getEmit().getXFant());
        this.txtXLgr.setText(this.nfeProc.getNFe().getInfNFe().getEmit().getEnderEmit().getXLgr());
        this.txtNro.setText(this.nfeProc.getNFe().getInfNFe().getEmit().getEnderEmit().getNro());
        this.txtXCpl.setText(this.nfeProc.getNFe().getInfNFe().getEmit().getEnderEmit().getXCpl());
        this.txtXBairro.setText(this.nfeProc.getNFe().getInfNFe().getEmit().getEnderEmit().getXBairro());
        this.txtCMun.setText(this.nfeProc.getNFe().getInfNFe().getEmit().getEnderEmit().getCMun());
        this.txtXMun.setText(this.nfeProc.getNFe().getInfNFe().getEmit().getEnderEmit().getXMun());
        this.txtUF.setText(this.nfeProc.getNFe().getInfNFe().getEmit().getEnderEmit().getUF().value());
        this.txtCEP.setText(this.nfeProc.getNFe().getInfNFe().getEmit().getEnderEmit().getCEP());
        this.txtCPais.setText(this.nfeProc.getNFe().getInfNFe().getEmit().getEnderEmit().getCPais());
        this.txtXPais.setText(this.nfeProc.getNFe().getInfNFe().getEmit().getEnderEmit().getXPais());
        this.txtFone.setText(this.nfeProc.getNFe().getInfNFe().getEmit().getEnderEmit().getFone());

        // Destinatario
        this.txtTCnpj1.setText(this.nfeProc.getNFe().getInfNFe().getDest().getCNPJ());
        this.txtTCpf1.setText(this.nfeProc.getNFe().getInfNFe().getDest().getCPF());
        this.txtXNome1.setText(this.nfeProc.getNFe().getInfNFe().getDest().getXNome());
        this.txtXLgr1.setText(this.nfeProc.getNFe().getInfNFe().getDest().getEnderDest().getXLgr());
        this.txtNro1.setText(this.nfeProc.getNFe().getInfNFe().getDest().getEnderDest().getNro());
        this.txtXCpl1.setText(this.nfeProc.getNFe().getInfNFe().getDest().getEnderDest().getXCpl());
        this.txtXBairro1.setText(this.nfeProc.getNFe().getInfNFe().getDest().getEnderDest().getXBairro());
        this.txtCMun1.setText(this.nfeProc.getNFe().getInfNFe().getDest().getEnderDest().getCMun());
        this.txtXMun1.setText(this.nfeProc.getNFe().getInfNFe().getDest().getEnderDest().getXMun());
        this.txtUF1.setText(this.nfeProc.getNFe().getInfNFe().getDest().getEnderDest().getUF().value());
        this.txtCEP1.setText(this.nfeProc.getNFe().getInfNFe().getDest().getEnderDest().getCEP());
        this.txtCPais1.setText(this.nfeProc.getNFe().getInfNFe().getDest().getEnderDest().getCPais());
        this.txtXPais1.setText(this.nfeProc.getNFe().getInfNFe().getDest().getEnderDest().getXPais());
        this.txtFone1.setText(this.nfeProc.getNFe().getInfNFe().getDest().getEnderDest().getFone());

        // Produtos
        this.atualizaTabProd();

        // Totais
        this.txtTotICMSVBC.setText(this.nfeProc.getNFe().getInfNFe().getTotal().getICMSTot().getVBC());
        this.txtTotICMSVICMS.setText(this.nfeProc.getNFe().getInfNFe().getTotal().getICMSTot().getVICMS());
        this.txtTotICMSVPROD.setText(this.nfeProc.getNFe().getInfNFe().getTotal().getICMSTot().getVProd());
        this.txtTotICMSVIPI.setText(this.nfeProc.getNFe().getInfNFe().getTotal().getICMSTot().getVIPI());
        this.txtTotICMSVPIS.setText(this.nfeProc.getNFe().getInfNFe().getTotal().getICMSTot().getVPIS());
        this.txtTotICMSVCOFINS.setText(this.nfeProc.getNFe().getInfNFe().getTotal().getICMSTot().getVCOFINS());
        this.txtTotICMSVNF.setText(this.nfeProc.getNFe().getInfNFe().getTotal().getICMSTot().getVNF());
        this.txtTotICMSVTotTrib.setText(this.nfeProc.getNFe().getInfNFe().getTotal().getICMSTot().getVTotTrib());

        // Informações Adicionais
        this.txtAreaInfAdFisco.setText(this.nfeProc.getNFe().getInfNFe().getInfAdic().getInfAdFisco());
        this.txtAreaInfCpl.setText(this.nfeProc.getNFe().getInfNFe().getInfAdic().getInfCpl());

    }   // preencheTela()

    /**
     * Atualiza a JTable dos Produtos da NF-e
     */
    private void atualizaTabProd() {

        this.ptm.addAll(this.nfeProc.getNFe().getInfNFe().getDet());
        this.jTableProd.setModel(this.ptm);
        this.jTableProd.setAutoResizeMode(JTable.AUTO_RESIZE_OFF);

    }   // void atualizaTabProd

    /**
     * Preenche os dados do XML de acordo com o preenchimentos das Telas
     */
    private void preencheXML() {

        this.txtCHNfe.setText(this.getChaveNfe());

        // Identificação da NF-e
        this.nfeProc.getNFe().getInfNFe().setId("NFe" + this.txtCHNfe.getText());
        this.nfeProc.getNFe().getInfNFe().getIde().setCNF(chaveNFe.getNfe());
        this.nfeProc.getNFe().getInfNFe().getIde().setNNF(Utils.alphaOutput(chaveNFe.getNfe()));
        this.nfeProc.getNFe().getInfNFe().getIde().setDhEmi(Utils.getTimeStamp());

        // Emitente
        this.nfeProc.getNFe().getInfNFe().getEmit().setCNPJ(this.txtTCnpj.getText());
        this.nfeProc.getNFe().getInfNFe().getEmit().setCPF(this.txtTCpf.getText());
        this.nfeProc.getNFe().getInfNFe().getEmit().setXNome(this.txtXNome.getText());
        this.nfeProc.getNFe().getInfNFe().getEmit().setXFant(this.txtXFant.getText());
        this.nfeProc.getNFe().getInfNFe().getEmit().getEnderEmit().setXLgr(this.txtXLgr.getText());
        this.nfeProc.getNFe().getInfNFe().getEmit().getEnderEmit().setNro(this.txtNro.getText());
        this.nfeProc.getNFe().getInfNFe().getEmit().getEnderEmit().setXCpl(this.txtXCpl.getText());
        this.nfeProc.getNFe().getInfNFe().getEmit().getEnderEmit().setXBairro(this.txtXBairro.getText());
        this.nfeProc.getNFe().getInfNFe().getEmit().getEnderEmit().setCMun(this.txtCMun.getText());
        this.nfeProc.getNFe().getInfNFe().getEmit().getEnderEmit().setXMun(this.txtXMun.getText());
        this.nfeProc.getNFe().getInfNFe().getEmit().getEnderEmit().setCEP(this.txtCEP.getText());
        this.nfeProc.getNFe().getInfNFe().getEmit().getEnderEmit().setCPais(this.txtCPais.getText());
        this.nfeProc.getNFe().getInfNFe().getEmit().getEnderEmit().setXPais(this.txtXPais.getText());
        this.nfeProc.getNFe().getInfNFe().getEmit().getEnderEmit().setFone(this.txtFone.getText());

        // Destinatario
        this.nfeProc.getNFe().getInfNFe().getDest().setCNPJ(this.txtTCnpj1.getText());
        this.nfeProc.getNFe().getInfNFe().getDest().setCPF(this.txtTCpf1.getText());
        this.nfeProc.getNFe().getInfNFe().getDest().setXNome(this.txtXNome1.getText());
        this.nfeProc.getNFe().getInfNFe().getDest().getEnderDest().setXLgr(this.txtXLgr1.getText());
        this.nfeProc.getNFe().getInfNFe().getDest().getEnderDest().setNro(this.txtNro1.getText());
        this.nfeProc.getNFe().getInfNFe().getDest().getEnderDest().setXCpl(this.txtXCpl1.getText());
        this.nfeProc.getNFe().getInfNFe().getDest().getEnderDest().setXBairro(this.txtXBairro1.getText());
        this.nfeProc.getNFe().getInfNFe().getDest().getEnderDest().setCMun(this.txtCMun1.getText());
        this.nfeProc.getNFe().getInfNFe().getDest().getEnderDest().setXMun(this.txtXMun1.getText());
        this.nfeProc.getNFe().getInfNFe().getDest().getEnderDest().setCEP(this.txtCEP1.getText());
        this.nfeProc.getNFe().getInfNFe().getDest().getEnderDest().setCPais(this.txtCPais1.getText());
        this.nfeProc.getNFe().getInfNFe().getDest().getEnderDest().setXPais(this.txtXPais1.getText());
        this.nfeProc.getNFe().getInfNFe().getDest().getEnderDest().setFone(this.txtFone1.getText());

        // Totais
        this.nfeProc.getNFe().getInfNFe().getTotal().getICMSTot().setVBC(this.txtTotICMSVBC.getText());
        this.nfeProc.getNFe().getInfNFe().getTotal().getICMSTot().setVICMS(this.txtTotICMSVICMS.getText());
        this.nfeProc.getNFe().getInfNFe().getTotal().getICMSTot().setVProd(this.txtTotICMSVPROD.getText());
        this.nfeProc.getNFe().getInfNFe().getTotal().getICMSTot().setVIPI(this.txtTotICMSVIPI.getText());
        this.nfeProc.getNFe().getInfNFe().getTotal().getICMSTot().setVPIS(this.txtTotICMSVPIS.getText());
        this.nfeProc.getNFe().getInfNFe().getTotal().getICMSTot().setVCOFINS(this.txtTotICMSVCOFINS.getText());
        this.nfeProc.getNFe().getInfNFe().getTotal().getICMSTot().setVNF(this.txtTotICMSVNF.getText());
        this.nfeProc.getNFe().getInfNFe().getTotal().getICMSTot().setVTotTrib(this.txtTotICMSVTotTrib.getText());

        // Informações Adicionais
        this.nfeProc.getNFe().getInfNFe().getInfAdic().setInfAdFisco(this.txtAreaInfAdFisco.getText());
        this.nfeProc.getNFe().getInfNFe().getInfAdic().setInfCpl(this.txtAreaInfCpl.getText());

        //Signature
        SignatureType signature = this.preencheSignature(this.nfeProc.getNFe().getSignature(), this.txtCHNfe.getText());
        this.nfeProc.getNFe().setSignature(signature);

        // Protocolo
        this.nfeProc.getProtNFe().getInfProt().setChNFe(this.txtCHNfe.getText());
        this.nfeProc.getProtNFe().getInfProt().setDhRecbto(Utils.getTimeStamp());

    }   // preencheXML()

    private SignatureType preencheSignature(SignatureType st, String chave) {

        SignatureType signature;
        SignedInfoType signedInfo;
        ReferenceType reference;
        SignatureValueType signatureValue;
        KeyInfoType keyInfo;

        if (st != null) {

            signature = st;
            reference = st.getSignedInfo().getReference();

            reference.setId("#NFe" + chave);
            reference.setURI("#NFe" + chave.substring(0, 29) + "240151090800009");
            signature.getSignedInfo().setReference(reference);

        } else {

            signature = null;

        }   // if (st != null)

        return signature;

    }   // preencheSignature()

    /**
     * Retorna a Nova Chave da NF-e
     *
     * @return Chave da NF-e
     */
    private String getChaveNfe() {

        String sChave = this.txtCHNfe.getText();
        this.chaveNFe = new ChaveNFeDAO(sChave);

        this.chaveNFe.gerarChave(this.txtTCnpj.getText());

        return this.chaveNFe.toString();

    }   // String getChaveNfe

    /**
     * Calcula o total da Nota Fiscal
     */
    public void calcTotalNFe() {

        ICMSTotalNFeDAO totalNFe = null;

        if (this.totais.size() > 0) {

            totalNFe = new ICMSTotalNFeDAO();

            // Sumaria os impostos
            for (String nItem : this.totais.keySet()) {

                totalNFe.addvBC(this.totais.get(nItem).getvBC());
                totalNFe.addvCOFINS(this.totais.get(nItem).getvCOFINS());
                totalNFe.addvICMS(this.totais.get(nItem).getvICMS());
                totalNFe.addvIPI(this.totais.get(nItem).getvIPI());
                totalNFe.addvPIS(this.totais.get(nItem).getvPIS());
                totalNFe.addvProd(this.totais.get(nItem).getvProd());

            }   // for (ICMSTotalNFeDAO totalNFe : totais)

        }   //

        // Preenche os campos da aba dos totais
        if (totalNFe != null) {

            this.txtTotICMSVBC.setText(String.valueOf(totalNFe.getvBC()));
            this.txtTotICMSVICMS.setText(String.valueOf(totalNFe.getvICMS()));
            this.txtTotICMSVPROD.setText(String.valueOf(totalNFe.getvProd()));
            this.txtTotICMSVIPI.setText(String.valueOf(totalNFe.getvIPI()));
            this.txtTotICMSVPIS.setText(String.valueOf(totalNFe.getvPIS()));
            this.txtTotICMSVCOFINS.setText(String.valueOf(totalNFe.getvCOFINS()));
            this.txtTotICMSVNF.setText(String.valueOf(totalNFe.getvBC()));
            this.txtTotICMSVTotTrib.setText(String.valueOf(totalNFe.getvBC()));

        }   // if (totalNFe != null)

    }   // void calcTotalNFe

    /**
     * Grava o arquivo XML
     */
    private void gravar() {

        this.calcTotalNFe();
        this.preencheXML();

        JFileChooser fileChooser = new JFileChooser();

        fileChooser.setFileFilter(new FileFilter() {
            @Override
            public boolean accept(File f) {
                return (f.getName().endsWith(".xml")) || f.isDirectory();
            }

            @Override
            public String getDescription() {
                return "*.xml";
            }
        });

        int returnVal = fileChooser.showSaveDialog(this);

        if (returnVal == JFileChooser.APPROVE_OPTION) {

            try {

                File file = fileChooser.getSelectedFile();

                JAXBContext context = JAXBContext.newInstance("br.com.robertopinetti.geradorxmlnfe.xml.dao");
                JAXBElement<TNfeProc> element = new ObjectFactory().createNfeProc(this.nfeProc);
//                JAXBElement<TNfeProc> element = new JAXBElement<>(new QName("nfeProc"), TNfeProc.class, this.nfeProc);
                Marshaller marshaller = context.createMarshaller();
                marshaller.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, false);
                marshaller.setProperty(Marshaller.JAXB_ENCODING, "ISO-8859-1");
                marshaller.marshal(element, file);

                ajustaArqXML(fileChooser.getName(), file);

                JOptionPane.showMessageDialog(null, "O arquivo XML " + fileChooser.getName(file) + " foi gravado!", "Gravado com Sucesso", JOptionPane.INFORMATION_MESSAGE);

            } catch (JAXBException ex) {
                Logger.getLogger(JFrmMain.class.getName()).log(Level.SEVERE, null, ex);
            } catch (IOException ex) {
                Logger.getLogger(JFrmMain.class.getName()).log(Level.SEVERE, null, ex);
            }

        } else {
            System.out.println("File access cancelled by user.");
        }

    }   // gravar()

    public void ajustaArqXML(String s, File inFile) throws IOException {

        String sLinha;
        String replace;

        File tempFile = new File(inFile.getAbsolutePath() + ".temp");
        BufferedReader br = new BufferedReader(new FileReader(inFile));
        PrintWriter pw = new PrintWriter(new FileWriter(tempFile));

        while ((sLinha = br.readLine()) != null) {

            if (sLinha.contains("xmlns:ns2") || sLinha.contains("xmlns:ns3")) {
                replace = sLinha.replaceAll("xmlns:ns2=\"http://www.w3.org/2000/09/xmldsig#\"", "");
                replace = replace.replaceAll("xmlns:ns3", "xmlns");
            } else if (sLinha.contains("ns2:")) {
                replace = sLinha.replace("ns2:", "");
            } else if (sLinha.contains(":ns2")) {
                replace = sLinha.replace(":ns2", "");
            } else if (sLinha.contains("ns3:")) {
                replace = sLinha.replace(":ns3", "");
            } else if (sLinha.contains(":ns3")) {
                replace = sLinha.replace("ns3:", "");
            } else {
                replace = sLinha;
            }

            pw.println(replace);

        }   // while ((sLinha = br.readLine()) != null)

        if (inFile.delete()) {
            System.out.println("Arquivo deletado");
        }   // if (inFile.delete())

        if (!tempFile.renameTo(inFile)) {
            System.out.println("Arquivo renomeado");
        }

    }   // void ajustaArqXML

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(JFrmMain.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(JFrmMain.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(JFrmMain.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(JFrmMain.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(() -> {
            new JFrmMain().setVisible(true);
        });
    }

}
